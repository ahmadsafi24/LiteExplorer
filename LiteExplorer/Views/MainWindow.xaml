<ui:UiWindow
    x:Class="LiteExplorer.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:c="clr-namespace:LiteExplorer.Converters"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:LiteExplorer.ViewModels"
    Width="1000"
    Height="600"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    WindowCornerPreference="Round"
    WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <vm:MainWindowViewModel />
    </Window.DataContext>

    <Window.InputBindings>
        <KeyBinding
            Key="W"
            Command="{Binding CloseAppCmd}"
            Modifiers="Ctrl" />
    </Window.InputBindings>

    <DockPanel>
        <ui:TitleBar
            Title="{Binding Title}"
            DockPanel.Dock="Top"
            Icon="pack://application:,,,/../wpfui.ico"
            UseSnapLayout="True">
            <ui:TitleBar.Header>
                <StackPanel Orientation="Horizontal" />
            </ui:TitleBar.Header>
        </ui:TitleBar>

        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <Label Content="{Binding FileSystemObjects.Count}" ContentStringFormat="Items: {0}" />
            </StatusBarItem>
            <StatusBarItem>
                <Label Content="{Binding ElementName=items, Path=SelectedItems.Count}" ContentStringFormat="Selected: {0}" />
            </StatusBarItem>
            <StatusBarItem>
                <Label Content="{Binding CurrentItem.Name}" ContentStringFormat="Current: {0}" />
            </StatusBarItem>
        </StatusBar>

        <TabControl>
            <TabItem Header="{Binding CurrentName, TargetNullValue='Home'}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <ui:Button
                            Grid.Column="0"
                            Command="{Binding BackCmd}"
                            CommandParameter="{Binding CurrentPath}"
                            Icon="ArrowLeft48"
                            ToolTip="Back" />
                        <ui:TextBox
                            Grid.Column="1"
                            HorizontalContentAlignment="Stretch"
                            Icon="Home48"
                            Text="{Binding CurrentPath, Mode=OneWay}" />
                        <ui:Button
                            Grid.Column="2"
                            Command="{Binding RunCmd}"
                            CommandParameter="notepad"
                            Icon="Notepad28"
                            ToolTip="Notepad" />
                        <ui:Button
                            Grid.Column="3"
                            Command="{Binding RunCmd}"
                            CommandParameter="cmd"
                            Icon="Send28"
                            ToolTip="Command prompt" />
                    </Grid>
                    <ListBox
                        x:Name="items"
                        Grid.Row="1"
                        ItemsSource="{Binding FileSystemObjects}"
                        SelectedItem="{Binding CurrentItem}"
                        SelectionMode="Extended">

                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="MouseDoubleClick">
                                <b:InvokeCommandAction Command="{Binding OpenCmd}" CommandParameter="{Binding CurrentItem}" />
                            </b:EventTrigger>
                        </b:Interaction.Triggers>

                        <ListBox.InputBindings>
                            <KeyBinding
                                Command="{Binding OpenCmd}"
                                CommandParameter="{Binding CurrentItem}"
                                Gesture="Enter" />
                            <KeyBinding
                                Command="{Binding OpenCmd}"
                                CommandParameter="{Binding CurrentItem}"
                                Gesture="Space" />
                            <KeyBinding
                                Command="{Binding BackCmd}"
                                CommandParameter="{Binding CurrentPath}"
                                Gesture="Backspace" />
                        </ListBox.InputBindings>

                        <ListBox.ItemTemplate>
                            <DataTemplate>

                                <DataTemplate.Resources>
                                    <c:Percent x:Key="PercentConverter" />
                                    <c:Space x:Key="SpaceConverter" />
                                </DataTemplate.Resources>

                                <Grid>

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="5*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="2*" />
                                    </Grid.ColumnDefinitions>

                                    <Grid Grid.Column="0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Image
                                            Grid.Column="0"
                                            Margin="0,0,5,3"
                                            Source="{Binding Image}" />
                                        <TextBlock Grid.Column="1">
                                            <TextBlock.Text>
                                                <MultiBinding StringFormat="{}{0} ({1})">
                                                    <Binding Path="Name" />
                                                    <Binding Path="Path" />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                    </Grid>
                                    <Label Grid.Column="1" Content="{Binding Format}" />
                                    <Label Grid.Column="2" Content="{Binding Type}" />
                                    <Label
                                        x:Name="totalSpace"
                                        Grid.Column="3"
                                        Content="{Binding TotalSpace, Converter={StaticResource SpaceConverter}}" />
                                    <Label
                                        x:Name="usedSpace"
                                        Grid.Column="4"
                                        Content="{Binding Size, Converter={StaticResource SpaceConverter}}"
                                        Foreground="SlateGray" />
                                    <Label
                                        x:Name="availableSpace"
                                        Grid.Column="5"
                                        Content="{Binding FreeSpace, Converter={StaticResource SpaceConverter}}"
                                        Foreground="YellowGreen" />
                                    <ProgressBar
                                        Grid.Column="6"
                                        Background="YellowGreen"
                                        Foreground="SlateGray">
                                        <ProgressBar.Value>
                                            <MultiBinding Converter="{StaticResource PercentConverter}">
                                                <Binding Path="TotalSpace" />
                                                <Binding Path="Size" />
                                            </MultiBinding>
                                        </ProgressBar.Value>
                                    </ProgressBar>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                </Grid>
            </TabItem>
        </TabControl>

    </DockPanel>

</ui:UiWindow>
